---
theme: theme.json
author: Cloud-Native Corner 
date: MMMM dd, YYYY
paging: Slide %d / %d
---

# Writing Custom Lua Functions in Neovim

```bash
~~~./intro.sh

~~~
```

---

## Introduction

- ðŸ§‘ Learn to develop Neovim plugins using `lua`
- ðŸš€ Customize and extend Neovim's functionality
- ðŸ› ï¸ Seamlessly integrate with existing Neovim features and plugins
- ðŸ“Š Create and share your own powerful plugins

> Easier than you think!

---

## When to use Plugins

- Macros/Substitution are good first idea
- Custom lua modules (watch my previous video)
- Test, deploy, share with the community

```bash
                        +-----------------------+                              
+----------------------|-+                      |     +---------------------+
|       Macros         | |    Lua Functions     |     |   Plugins/Advanced  |
|   (Simple Tasks)     | | (Complex Operations) |---> |   Customization     |
+----------------------|-|                      |     +---------------------+
                        +-----------------------+                             
```

---

## What is a plugin?

- A plugin is just a `lua` module(s)
- We can load it like any other `lua` module
- Remote plugins vs lua plugins

> Plugins are about packaging, deployment and sharing 

---

## Plugin managers

Make plugin life cycle process easier

- lazy.nvim  -----> use this if you start today
- packer
- rocks.nvim -----> this guy has real semantic visioning

> There are many more

---

## Creating a plugin repository 

> There are a few plugin templates but this is the best IMO

```bash
xdg-open https://github.com/nvimdev/nvim-plugin-template
```

```bash
/home/decoder/dev/my-mvin-plugins/typeit.nvim/
â”œâ”€â”€ doc
â”‚Â Â  â””â”€â”€ typeit.nvim.txt                      -----> autogenerated by CI
â”œâ”€â”€ LICENSE
â”œâ”€â”€ lua
â”‚Â Â  â””â”€â”€ typeit
â”‚Â Â      â””â”€â”€ init.lua                         -----> plugin logic
â”œâ”€â”€ plugin
â”‚Â Â  â””â”€â”€ typeit.lua                           -----> version info, UserCommands etc
â”œâ”€â”€ README.md
â””â”€â”€ test
    â””â”€â”€ plugin_spec.lua                      -----> tests with `vusted`

5 directories, 6 files
```

---

## Development Tools 

- `mfussenegger/nvim-dap`                 -----> for debugging
- `notomo/vusted`                         -----> for testing
- `jbyuki/one-small-step-for-vimkind`     -----> for dap lua adapter

> Useful for testing and debugging`plugins`

---


## Setup Debugging

```bash
../npane "+34 ~/dev/dotfiles/.config/nvim/lua/lsp/dap.lua"
```                                             

1. Open a Neovim instance (instance A)
2. Launch the DAP server with (A) > :lua require"osv".launch({port=8086})
3. Open another Neovim instance (instance B)
4. Open `myscript.lua` (B)
5. Place a breakpoint on line 2 using (B) > :lua require"dap".toggle_breakpoint()
6. Connect the DAP client using (B) > :lua require"dap".continue()
7. Run `myscript.lua` in the other instance (A) > :luafile myscript.lua
8. The breakpoint should hit and freeze the instance (B)

---
                                        
## Autocommand for plugin reload

> Fancy version ðŸŽ

```bash
../npane "~/dev/dotfiles/.config/nvim/ftplugin/lua.lua" 
```

> Alternative way is to `nvim --cmd "set rtp+=./" plugin.lua`
> This adds current directory to `runtimepath`

---

## Testing with `vusted`

> ðŸš¨ Unit tests are important mkay

Example

```bash
../npane ./greeter/test/plugin_spec.lua
```

Bonus point for running `entr` with test loop

`\ls greeter.lua | entr -r vusted test`

---

## That's all folks

```
~~~chafa --format symbols folks.jpg
placeholder text
~~~
```
